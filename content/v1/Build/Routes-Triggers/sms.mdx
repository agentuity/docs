---
title: SMS Handling
description: Process incoming text messages with router.sms()
---

Handle incoming SMS messages sent to a phone number. Phone numbers are configured in code and integrated with Twilio automatically when deployed.

## Basic Example

```typescript
import { createRouter } from '@agentuity/runtime';

const router = createRouter();

router.sms({ number: '+1234567890' }, async (c) => {
  // Parse Twilio payload
  const formData = await c.req.parseBody();
  const from = formData['From'] as string;
  const body = formData['Body'] as string;

  const reply = await c.agent.smsBot.run({
    sender: from,
    message: body,
  });

  // Return value is sent as SMS reply
  return c.text(reply);
});

export default router;
```

## Parsing Twilio Payloads

Twilio sends webhooks in form-encoded format by default, but can also send JSON:

```typescript
router.sms({ number: '+1234567890' }, async (c) => {
  let from = 'unknown';
  let body = '';

  const contentType = c.req.header('content-type') || '';

  if (contentType.includes('application/x-www-form-urlencoded')) {
    // Default Twilio format
    const formData = await c.req.parseBody();
    from = formData['From'] as string;
    body = formData['Body'] as string;
  } else if (contentType.includes('application/json')) {
    // JSON format (if configured)
    const data = await c.req.json();
    from = data.From || data.from;
    body = data.Body || data.message;
  }

  const reply = await c.agent.smsHandler.run({ from, body });
  return c.text(reply);
});
```

## Full Example

An SMS bot that handles commands and provides help:

```typescript
import { createRouter } from '@agentuity/runtime';

const router = createRouter();

router.sms({ number: '+1234567890' }, async (c) => {
  try {
    const formData = await c.req.parseBody();
    const from = formData['From'] as string;
    const body = (formData['Body'] as string).trim().toLowerCase();

    c.var.logger.info('SMS received', { from, body });

    // Handle commands
    if (body === 'help') {
      return c.text('Commands: STATUS, BALANCE, HELP');
    }

    if (body === 'status') {
      const status = await c.agent.statusChecker.run({ userId: from });
      return c.text(`Your status: ${status.message}`);
    }

    if (body === 'balance') {
      const balance = await c.agent.balanceChecker.run({ phone: from });
      return c.text(`Balance: $${balance.amount}`);
    }

    // Default response
    return c.text('Unknown command. Text HELP for options.');
  } catch (error) {
    c.var.logger.error('SMS processing failed', { error });
    return c.text('Sorry, something went wrong. Try again later.');
  }
});

export default router;
```

## Phone Number Format

Phone numbers must use E.164 international format: `+[country code][number]` with no spaces or dashes (e.g., `+1234567890`).

## How Replies Work

The text you return from the handler is automatically sent as an SMS reply to the sender. Agentuity handles the Twilio TwiML response format for you.

```typescript
// This text is sent back to the sender as an SMS
return c.text('Thanks for your message!');
```

## Next Steps

- [Email Handling](/Build/Routes-Triggers/email): Process incoming emails
- [WebSockets](/Build/Routes-Triggers/websockets): Real-time bidirectional communication
- [HTTP Routes](/Build/Routes-Triggers/http-routes): Standard API endpoints
